#include <iostream>
#include <stdlib.h>
#include <math.h>
#include <conio.h>
#include <fstream>
#define MAX 100
#define exp 0.001
using namespace std;
double calculate(int n, double a[][MAX], double *y){
	int i,j,lap,dem = 0;
	double x[MAX];
	do
					{
						lap = 0;
						dem++;
						for (i = 1; i <= n; i++)
						{
							double s = 0;
							for (j = 1; j <= n; j++)
								if (j != i)
								{
									s += a[i][j] * x[j];
									y[i] = (a[i][n + 1] - s);
								}
								y[i] = y[i] / a[i][i];
							
							if (fabs(x[i] - y[i]) > exp && dem < 30)
								lap = 1;
						}
						for (i = 1; i <= n; i++)
						{
							x[i] = y[i];
						}
						for (i = 1; i <= n; i++)
						{
							printf("\t\t%0.4f\t\t||", x[i]);
						}
						cout << "\n";
					} while (lap);
}
void readfile(double a[][MAX],int &n,string topicName){
	fstream f;
	f.open((topicName + ".txt").c_str()); /* mo file doc n va ma tran */
	if (f.fail())
	{
		do
		{
			cout << "Failed to open this file!" << endl;
			cout << " \t\t\tnhap lai ten file: ";
				cin >> topicName;
			f.open((topicName + ".txt").c_str());
		} while (f.fail());
	}
	f >> n; /* nhap n */
	for (int i = 1; i <= n; i++)
		for (int j = 1; j <= n + 1; j++)
		{
			f >> a[i][j]; /* nhap ma tran */
		}
	if (f == NULL)
		cout << "So lieu khong hop le";
	f.close();
}

void editfile(double a[][MAX], int &n)
{
	int i, j;
	string topicName,fileName;
	cout << "nhap ten file can sua: ";
	cin >> fileName;
	topicName = "notepad \"" + fileName + "\"";
	system(topicName.c_str());
	readfile(a,n,fileName);
}
void openfile(double a[][MAX],int &n) {
	int i,j;	
	string Name;
	cout << "nhap ten file: ";
	cin >> Name;
	readfile(a,n,Name);
}
void xuatmatran(double a[][MAX], int &n) /* xuat ma tran hai chieu */
{
	for (int i = 1; i <= n; i++)
	{
		cout << "\t\t\t\t";
		for (int j = 1; j <= n + 1; j++)
			cout << a[i][j] << "\t";
		cout << "\n\n"
			 << endl;
	}
}
void nhap(double *a, int &n)
{ /* nhap day n phan tu */
	int i;
	for (i = 1; i <= n; i++)
	{
		cout << "\t\tx" << i << "= ";
		cin >> a[i];
	}
}
/* Xuat day n phan tu */
int dkht(double a[][MAX], int n)
{	double b[MAX][MAX];
	int s,sum=0;
	s=1;
	for (int i=1;i<=n;i++) 
	{
		
		for(int j=1;j<=n;j++)
		{
			b[i][j]=a[i][j];
			b[i][i]=0;
			sum=sum+b[i][j]/a[i][i];
		}
		if(fabs(sum)<1)
		s=s+1;
	}
	if (s<4) return 0;
	else return 1;
}
	 

void xuat(double a[], int &n)
{
	int i;
	for (i = 1; i <= n; i++)
	{
		cout << "\n\t\tx[" << i << "]= " << a[i] << " ";
	}
}
void swap(double &a, double &b)
{
	int temp = a;
	a = b;
	b = temp;
}
void menu()
{
	system("cls"); // lenh xoa man hinh
	cout << "\t\t\t---------------------------------------------------------------------" << endl;
	cout << "\t\t\t\t   *********************************" << endl;
	cout << "\t\t\t\t\t MENU giai phuong trinh tuyen tinh\n"
		 << endl;
	cout << "\n"
		 << endl;
	cout << "\t\t\t\t\t1 xuat ma tran\n"
		 << endl;

	cout << "\t\t\t\t\t2 giai bang phuong phap gauss siedel\n"
		 << endl;
	cout << "\t\t\t\t\t3 tro ve de nhap file khac\n"
		 << endl;
	cout << "\t\t\t\t\t4 vao file de sua du lieu(khi xong luu va thoat de tiep tuc)\n"
		 << endl;
	cout << "\t\t\t\t\t5 EXIT\n"
		 << endl;
	cout << "\t\t\t\t   *********************************" << endl;
	cout << "\t\t\t---------------------------------------------------------------------" << endl;
	cout << " MOI BAN CHON: ";
}
void intro()
{
		cout << "          ----------------------------------------------------------------------------------------------------" << endl;
	cout << "          |                                     NHOM SINH VIEN THUC HIEN                                     |" << endl;
	cout << "          |                                          HO THANH HUNG                                           |" << endl;
	cout << "          |                                          TRAN ANH HAO                                            |" << endl;
	cout << "          |                                        DE TAI DO AN KY 2                                         |" << endl;
	cout << "          |                  VIET CHUONG TRINH GIAI HE PHUONG TRINH BANG PHUONG PHAP GAUSS SEIDEL            |" << endl;
	cout << "          ----------------------------------------------------------------------------------------------------" << endl;
}

int main()
{
	int n, i, j, lap, dem, chon,dead;
	double x[MAX], y[MAX];
	double a[MAX][MAX];
	char tt,f,g;
	string Name;
	intro();

	do
	{

		system("pause");
		system("cls");
		openfile(a,n);
		do
		{

			system("pause");
			system("cls");

			menu();
			cin >> chon;

			switch (chon)
			{
			case 1:
			{
				cout << "Ma tran " << n << " hang " << n + 1 << " cot" << endl;
				cout << "He so cua phuong trinh: " << endl;
				xuatmatran(a, n);
				break;
				system("pause");
			}
			case 2:
			{  
				while (1)
				{
					for(i=1;i<=n;i++)
					{
						if(a[i][i]==0) for(int j=1;j<=n+1;j++) {
							if (i<n)  swap(a[i+1][j],a[i][j]); 
							else swap(a[1][j],a[i][j]); } 
							 
						
					}
					xuatmatran(a,n);
					if (dkht(a,n) == 0) 
					{
							cout << "khong thoa man dieu kien hoi tu" << endl;
							break;
					} 
					else if(dkht(a,n)==1) 
					{
							cout << "thoa man dieu kien hoi tu\n"; 
					}
					
					dem = 0;
					cout << "\n\n Nhap xap xi nghiem ban dau : " << endl;
					nhap(x, n);
					calculate(n, a, y);
					if (dem < 30)
					{
						cout << "\n Nghiem cua he phuong trinh : ";
						xuat(y, n);
					}
					else
						cout << " \n He phtrinh ko giai duoc bang phuong phap nay";

					cout << "\n\n Ban tiep tuc ko(c/k)?\n";
					tt = getch();
					if (tt != 'c')
						break;
				}
				break;
			}
				
			case 3:
			{

				break;
			}

			case 4:
			{
				editfile(a,n);
				break;
			}
			case 5:
			{
				cout << "\t\t\tket thuc chuong trinh";
				return 0;
			}
			default:
			{
				cout << "MOI BAN NHAP LAI !" << endl;
				break;
			}
			}
		} while ((chon != 3));
	} while (chon != 5);
}
